<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSE成績計算器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #c5cae9 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }

        .header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .icon {
            width: 32px;
            height: 32px;
            color: #1976d2;
        }

        h1 {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .warning-box {
            background: #ffebee;
            border: 1px solid #ffcdd2;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            display: none;
        }

        .warning-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #c62828;
            margin-bottom: 10px;
        }

        .warning-text {
            color: #d32f2f;
            font-size: 0.9rem;
        }

        .subject-section {
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .english-section { background: #e3f2fd; }
        .chinese-section { background: #ffebee; }
        .math-section { background: #e8f5e8; }
        .citizenship-section { background: #f3e5f5; }
        .elective-section { background: #fff3e0; }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .english-title { color: #1565c0; }
        .chinese-title { color: #c62828; }
        .math-title { color: #2e7d32; }
        .citizenship-title { color: #7b1fa2; }
        .elective-title { color: #ef6c00; }

        .input-grid {
            display: grid;
            gap: 20px;
        }

        .input-grid-2 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        .input-grid-4 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        input, select {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }

        .calculate-btn {
            width: 100%;
            background: #1976d2;
            color: white;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .calculate-btn:hover {
            background: #1565c0;
        }

        .results-section {
            display: none;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .results-subsection {
            margin-bottom: 30px;
        }

        .subsection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .result-grade {
            font-weight: 600;
            color: #1976d2;
        }

        .best5-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #c5cae9 100%);
            border-radius: 12px;
            padding: 25px;
        }

        .best5-result {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .best5-value {
            font-weight: bold;
            color: #1976d2;
        }

        .best5-combination {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }

        .note-box {
            margin-top: 25px;
            padding: 20px;
            background: #fffbf0;
            border-radius: 8px;
            border-left: 4px solid #ff9800;
        }

        .note-text {
            font-size: 0.9rem;
            color: #e65100;
        }

        @media (max-width: 768px) {
            .input-grid-4 {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                </svg>
                <h1>DSE成績計算器</h1>
            </div>
            <p class="subtitle">基於歷年Cut Off數據，支援分卷計分</p>

            <div id="warningBox" class="warning-box">
                <div class="warning-title">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path>
                    </svg>
                    注意事項
                </div>
                <div id="warningMessages"></div>
            </div>

            <!-- 英文科目 -->
            <div class="subject-section english-section">
                <h2 class="section-title english-title">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"></path>
                    </svg>
                    英文科（滿分100分）
                </h2>
                <div class="input-grid input-grid-4">
                    <div class="input-group">
                        <label>卷一 (25%)</label>
                        <input type="number" id="englishP1" min="0" max="100" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>卷二 (25%)</label>
                        <input type="number" id="englishP2" min="0" max="100" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>卷三 (35%)</label>
                        <input type="number" id="englishP3" min="0" max="100" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>卷四 (15%)</label>
                        <input type="number" id="englishP4" min="0" max="100" step="0.1">
                    </div>
                </div>
            </div>

            <!-- 中文科目 -->
            <div class="subject-section chinese-section">
                <h2 class="section-title chinese-title">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"></path>
                    </svg>
                    中文科（滿分100分）
                </h2>
                <div class="input-grid input-grid-2">
                    <div class="input-group">
                        <label>卷一 (50%)</label>
                        <input type="number" id="chineseP1" min="0" max="100" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>卷二 (50%)</label>
                        <input type="number" id="chineseP2" min="0" max="100" step="0.1">
                    </div>
                </div>
            </div>

            <!-- 數學科目 -->
            <div class="subject-section math-section">
                <h2 class="section-title math-title">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"></path>
                    </svg>
                    數學科（滿分100分）
                </h2>
                <div class="input-grid input-grid-2">
                    <div class="input-group">
                        <label>卷一 (65%)</label>
                        <input type="number" id="mathP1" min="0" max="100" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>卷二 (35%)</label>
                        <input type="number" id="mathP2" min="0" max="100" step="0.1">
                    </div>
                </div>
            </div>

            <!-- 公民科 -->
            <div class="subject-section citizenship-section">
                <h2 class="section-title citizenship-title">公民與社會發展科</h2>
                <div class="input-group">
                    <select id="citizenship">
                        <option value="達標">達標</option>
                        <option value="未達標">未達標</option>
                    </select>
                </div>
            </div>

            <!-- 選修科目 -->
            <div class="subject-section elective-section">
                <h2 class="section-title elective-title">選修科目</h2>
                <div class="input-grid input-grid-2" style="margin-bottom: 20px;">
                    <div class="input-group">
                        <label>選修1科目</label>
                        <select id="elective1Subject">
                            <option value="">請選擇科目</option>
                            <option value="Biology">Biology</option>
                            <option value="Chemistry">Chemistry</option>
                            <option value="Physics">Physics</option>
                            <option value="Economics">Economics</option>
                            <option value="Chinese History">Chinese History</option>
                            <option value="Geography">Geography</option>
                            <option value="ICT">ICT</option>
                            <option value="M1">M1</option>
                            <option value="M2">M2</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>分數 (0-100)</label>
                        <input type="number" id="elective1Score" min="0" max="100" step="0.1">
                    </div>
                </div>
                <div class="input-grid input-grid-2" style="margin-bottom: 20px;">
                    <div class="input-group">
                        <label>選修2科目</label>
                        <select id="elective2Subject">
                            <option value="">請選擇科目</option>
                            <option value="Biology">Biology</option>
                            <option value="Chemistry">Chemistry</option>
                            <option value="Physics">Physics</option>
                            <option value="Economics">Economics</option>
                            <option value="Chinese History">Chinese History</option>
                            <option value="Geography">Geography</option>
                            <option value="ICT">ICT</option>
                            <option value="M1">M1</option>
                            <option value="M2">M2</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>分數 (0-100)</label>
                        <input type="number" id="elective2Score" min="0" max="100" step="0.1">
                    </div>
                </div>
                <div class="input-grid input-grid-2">
                    <div class="input-group">
                        <label>選修3科目</label>
                        <select id="elective3Subject">
                            <option value="">請選擇科目</option>
                            <option value="Biology">Biology</option>
                            <option value="Chemistry">Chemistry</option>
                            <option value="Physics">Physics</option>
                            <option value="Economics">Economics</option>
                            <option value="Chinese History">Chinese History</option>
                            <option value="Geography">Geography</option>
                            <option value="ICT">ICT</option>
                            <option value="M1">M1</option>
                            <option value="M2">M2</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>分數 (0-100)</label>
                        <input type="number" id="elective3Score" min="0" max="100" step="0.1">
                    </div>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateResults()">計算成績</button>
        </div>

        <!-- 結果顯示 -->
        <div id="resultsSection" class="card results-section">
            <h2 class="results-title">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd"></path>
                </svg>
                計算結果
            </h2>

            <div class="results-subsection">
                <h3 class="subsection-title">核心科目成績</h3>
                <div id="coreResults"></div>
            </div>

            <div id="electiveResults" class="results-subsection">
                <h3 class="subsection-title">選修科目成績</h3>
                <div id="electiveResultsContent"></div>
            </div>

            <div class="best5-section">
                <h3 class="subsection-title">Best 5 計算結果</h3>
                <div id="best5Results"></div>
                <div class="best5-combination">
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">Best 5 等級組合：</p>
                    <p id="best5Combination" style="font-weight: 600; color: #333;"></p>
                </div>
            </div>

            <div class="note-box">
                <p class="note-text">
                    <strong>注：</strong>大學入學計分標準（5**=7分，5*=6分，5=5分，4=4分，3=3分，2=2分，1=1分）
                </p>
            </div>
        </div>
    </div>

    <script>
        // 等級2的最低分數線（參考歷年數據）
        const grade2Cutoff = {
            english: 35,
            chinese: 40,
            math: 38
        };

        // 計算總分
        function calculateTotalScore(subject, p1, p2, p3 = null, p4 = null) {
            if (subject === 'english') {
                return p1 * 0.25 + p2 * 0.25 + p3 * 0.35 + p4 * 0.15;
            } else if (subject === 'chinese') {
                return p1 * 0.5 + p2 * 0.5;
            } else if (subject === 'math') {
                return p1 * 0.65 + p2 * 0.35;
            }
            return 0;
        }

        // 分數轉等級
        function scoreToGrade(score) {
            if (score >= 90) return { grade: '5**', points: 7 };
            if (score >= 80) return { grade: '5*', points: 6 };
            if (score >= 70) return { grade: '5', points: 5 };
            if (score >= 60) return { grade: '4', points: 4 };
            if (score >= 50) return { grade: '3', points: 3 };
            if (score >= 40) return { grade: '2', points: 2 };
            return { grade: '1', points: 1 };
        }

        function calculateResults() {
            const warnings = [];
            
            // 獲取輸入值
            const englishP1 = parseFloat(document.getElementById('englishP1').value) || 0;
            const englishP2 = parseFloat(document.getElementById('englishP2').value) || 0;
            const englishP3 = parseFloat(document.getElementById('englishP3').value) || 0;
            const englishP4 = parseFloat(document.getElementById('englishP4').value) || 0;
            
            const chineseP1 = parseFloat(document.getElementById('chineseP1').value) || 0;
            const chineseP2 = parseFloat(document.getElementById('chineseP2').value) || 0;
            
            const mathP1 = parseFloat(document.getElementById('mathP1').value) || 0;
            const mathP2 = parseFloat(document.getElementById('mathP2').value) || 0;
            
            const citizenship = document.getElementById('citizenship').value;

            // 計算核心科目總分
            const englishTotal = calculateTotalScore('english', englishP1, englishP2, englishP3, englishP4);
            const chineseTotal = calculateTotalScore('chinese', chineseP1, chineseP2);
            const mathTotal = calculateTotalScore('math', mathP1, mathP2);

            // 檢查是否低於等級2分數線
            if (englishTotal < grade2Cutoff.english) {
                warnings.push('英文總分低於等級2分數線，建議放棄此科目');
            }
            if (chineseTotal < grade2Cutoff.chinese) {
                warnings.push('中文總分低於等級2分數線，建議放棄此科目');
            }
            if (mathTotal < grade2Cutoff.math) {
                warnings.push('數學總分低於等級2分數線，建議放棄此科目');
            }

            // 顯示警告
            const warningBox = document.getElementById('warningBox');
            const warningMessages = document.getElementById('warningMessages');
            
            if (warnings.length > 0) {
                warningMessages.innerHTML = warnings.map(warning => 
                    `<p class="warning-text">${warning}</p>`
                ).join('');
                warningBox.style.display = 'block';
                document.getElementById('resultsSection').style.display = 'none';
                return;
            } else {
                warningBox.style.display = 'none';
            }

            // 計算等級
            const englishGrade = scoreToGrade(englishTotal);
            const chineseGrade = scoreToGrade(chineseTotal);
            const mathGrade = scoreToGrade(mathTotal);

            // 處理選修科目
            const electives = [];
            for (let i = 1; i <= 3; i++) {
                const subject = document.getElementById(`elective${i}Subject`).value;
                const score = parseFloat(document.getElementById(`elective${i}Score`).value);
                
                if (subject && !isNaN(score)) {
                    electives.push({
                        subject: subject,
                        score: score,
                        ...scoreToGrade(score)
                    });
                }
            }

            // Best 5 計算
            const allSubjects = [
                { name: '中文', score: chineseTotal, ...chineseGrade },
                { name: '英文', score: englishTotal, ...englishGrade },
                { name: '數學', score: mathTotal, ...mathGrade },
                ...electives
            ];

            allSubjects.sort((a, b) => b.points - a.points);
            const best5 = allSubjects.slice(0, 5);
            const best5Total = best5.reduce((sum, subject) => sum + subject.score, 0);
            const best5Points = best5.reduce((sum, subject) => sum + subject.points, 0);
            const weightedAverage = best5Total / 5;

            // 顯示結果
            displayResults({
                coreSubjects: {
                    chinese: { total: chineseTotal, ...chineseGrade },
                    english: { total: englishTotal, ...englishGrade },
                    math: { total: mathTotal, ...mathGrade }
                },
                electives,
                best5,
                best5Total: best5Total.toFixed(1),
                best5Points,
                weightedAverage: weightedAverage.toFixed(1),
                citizenship
            });
        }

        function displayResults(results) {
            // 核心科目結果
            const coreResults = document.getElementById('coreResults');
            coreResults.innerHTML = `
                <div class="result-item">
                    <span>中文：${results.coreSubjects.chinese.total.toFixed(1)}分</span>
                    <span class="result-grade">${results.coreSubjects.chinese.grade}</span>
                </div>
                <div class="result-item">
                    <span>英文：${results.coreSubjects.english.total.toFixed(1)}分</span>
                    <span class="result-grade">${results.coreSubjects.english.grade}</span>
                </div>
                <div class="result-item">
                    <span>數學：${results.coreSubjects.math.total.toFixed(1)}分</span>
                    <span class="result-grade">${results.coreSubjects.math.grade}</span>
                </div>
                <div class="result-item">
                    <span>公民與社會發展科</span>
                    <span style="font-weight: 600; color: #2e7d32;">${results.citizenship}</span>
                </div>
            `;

            // 選修科目結果
            const electiveResults = document.getElementById('electiveResults');
            const electiveResultsContent = document.getElementById('electiveResultsContent');
            
            if (results.electives.length > 0) {
                electiveResults.style.display = 'block';
                electiveResultsContent.innerHTML = results.electives.map(elective => `
                    <div class="result-item">
                        <span>${elective.subject}：${elective.score}分</span>
                        <span class="result-grade">${elective.grade}</span>
                    </div>
                `).join('');
            } else {
                electiveResults.style.display = 'none';
            }

            // Best 5 結果
            const best5Results = document.getElementById('best5Results');
            best5Results.innerHTML = `
                <div class="best5-result">
                    <span>Best 5 原始總分：</span>
                    <span class="best5-value">${results.best5Total}分</span>
                </div>
                <div class="best5-result">
                    <span>Best 5 等級總分（大學計分）：</span>
                    <span class="best5-value">${results.best5Points}分</span>
                </div>
                <div class="best5-result">
                    <span>學校加權平均分：</span>
                    <span class="best5-value">${results.weightedAverage}分</span>
                </div>
            `;

            const best5Combination = document.getElementById('best5Combination');
            best5Combination.textContent = results.best5.map(subject => subject.grade).join(' / ');

            // 顯示結果區域
            document.getElementById('resultsSection').style.display = 'block';
        }
    </script>
</body>
</html>

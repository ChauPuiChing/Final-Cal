<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSEæˆç¸¾è¨ˆç®—å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
            min-height: 100vh;
            padding: 16px;
        }

        .container {
            max-width: 1024px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 24px;
        }

        .header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: bold;
            color: #1f2937;
        }

        .icon {
            width: 32px;
            height: 32px;
            color: #2563eb;
        }

        .subtitle {
            color: #6b7280;
            margin-bottom: 32px;
        }

        .warning {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .warning h3 {
            color: #991b1b;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .warning p {
            color: #7f1d1d;
            font-size: 0.875rem;
        }

        .subject-section {
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .subject-section h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .english { background: #eff6ff; }
        .english h2 { color: #1e40af; }

        .chinese { background: #fef2f2; }
        .chinese h2 { color: #991b1b; }

        .math { background: #f0fdf4; }
        .math h2 { color: #166534; }

        .citizenship { background: #faf5ff; }
        .citizenship h2 { color: #7c2d12; }

        .electives { background: #fff7ed; }
        .electives h2 { color: #ea580c; }

        .grid {
            display: grid;
            gap: 16px;
        }

        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        input, select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }

        .btn-primary {
            width: 100%;
            background: #2563eb;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .results {
            display: none;
        }

        .results.show {
            display: block;
        }

        .result-section {
            margin-bottom: 24px;
        }

        .result-section h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f9fafb;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .result-grade {
            font-weight: 600;
            color: #2563eb;
        }

        .best5-section {
            background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
            border-radius: 8px;
            padding: 24px;
        }

        .note {
            margin-top: 24px;
            padding: 16px;
            background: #fefce8;
            border-radius: 8px;
        }

        .note p {
            font-size: 0.875rem;
            color: #92400e;
            margin-bottom: 8px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                </svg>
                <h1>DSEæˆç¸¾è¨ˆç®—å™¨</h1>
            </div>
            <p class="subtitle">åŸºæ–¼æ­·å¹´Cut Offæ•¸æ“šï¼Œæ”¯æ´åˆ†å·è¨ˆåˆ†</p>

            <div id="warnings" class="warning hidden">
                <h3>âš ï¸ æ³¨æ„äº‹é …</h3>
                <div id="warning-messages"></div>
            </div>

            <!-- è‹±æ–‡ç§‘ç›® -->
            <div class="subject-section english">
                <h2>ğŸ“– è‹±æ–‡ç§‘ï¼ˆæ»¿åˆ†100åˆ†ï¼‰</h2>
                <div class="grid grid-4">
                    <div class="form-group">
                        <label>å·ä¸€ (25%)</label>
                        <input type="number" id="englishP1" min="0" max="100" placeholder="0-100">
                    </div>
                    <div class="form-group">
                        <label>å·äºŒ (25%)</label>
                        <input type="number" id="englishP2" min="0" max="100" placeholder="0-100">
                    </div>
                    <div class="form-group">
                        <label>å·ä¸‰ (35%)</label>
                        <input type="number" id="englishP3" min="0" max="100" placeholder="0-100">
                    </div>
                    <div class="form-group">
                        <label>å·å›› (15%)</label>
                        <input type="number" id="englishP4" min="0" max="100" placeholder="0-100">
                    </div>
                </div>
            </div>

            <!-- ä¸­æ–‡ç§‘ç›® -->
            <div class="subject-section chinese">
                <h2>ğŸ“– ä¸­æ–‡ç§‘ï¼ˆæ»¿åˆ†100åˆ†ï¼‰</h2>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label>å·ä¸€ (50%)</label>
                        <input type="number" id="chineseP1" min="0" max="100" placeholder="0-100">
                    </div>
                    <div class="form-group">
                        <label>å·äºŒ (50%)</label>
                        <input type="number" id="chineseP2" min="0" max="100" placeholder="0-100">
                    </div>
                </div>
            </div>

            <!-- æ•¸å­¸ç§‘ç›® -->
            <div class="subject-section math">
                <h2>ğŸ“– æ•¸å­¸ç§‘ï¼ˆæ»¿åˆ†100åˆ†ï¼‰</h2>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label>å·ä¸€ (65%)</label>
                        <input type="number" id="mathP1" min="0" max="100" placeholder="0-100">
                    </div>
                    <div class="form-group">
                        <label>å·äºŒ (35%)</label>
                        <input type="number" id="mathP2" min="0" max="100" placeholder="0-100">
                    </div>
                </div>
            </div>

            <!-- å…¬æ°‘ç§‘ -->
            <div class="subject-section citizenship">
                <h2>å…¬æ°‘èˆ‡ç¤¾æœƒç™¼å±•ç§‘</h2>
                <select id="citizenship">
                    <option value="é”æ¨™">é”æ¨™</option>
                    <option value="æœªé”æ¨™">æœªé”æ¨™</option>
                </select>
            </div>

            <!-- é¸ä¿®ç§‘ç›® -->
            <div class="subject-section electives">
                <h2>é¸ä¿®ç§‘ç›®</h2>
                <div class="form-group">
                    <div class="grid grid-2">
                        <div>
                            <label>é¸ä¿®1ç§‘ç›®</label>
                            <select id="elective1Subject">
                                <option value="">è«‹é¸æ“‡ç§‘ç›®</option>
                                <option value="Biology">Biology</option>
                                <option value="Chemistry">Chemistry</option>
                                <option value="Physics">Physics</option>
                                <option value="Economics">Economics</option>
                                <option value="Chinese History">Chinese History</option>
                                <option value="Geography">Geography</option>
                                <option value="ICT">ICT</option>
                                <option value="M1">M1</option>
                                <option value="M2">M2</option>
                            </select>
                        </div>
                        <div>
                            <label>åˆ†æ•¸ (0-100)</label>
                            <input type="number" id="elective1Score" min="0" max="100" placeholder="0-100">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="grid grid-2">
                        <div>
                            <label>é¸ä¿®2ç§‘ç›®</label>
                            <select id="elective2Subject">
                                <option value="">è«‹é¸æ“‡ç§‘ç›®</option>
                                <option value="Biology">Biology</option>
                                <option value="Chemistry">Chemistry</option>
                                <option value="Physics">Physics</option>
                                <option value="Economics">Economics</option>
                                <option value="Chinese History">Chinese History</option>
                                <option value="Geography">Geography</option>
                                <option value="ICT">ICT</option>
                                <option value="M1">M1</option>
                                <option value="M2">M2</option>
                            </select>
                        </div>
                        <div>
                            <label>åˆ†æ•¸ (0-100)</label>
                            <input type="number" id="elective2Score" min="0" max="100" placeholder="0-100">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="grid grid-2">
                        <div>
                            <label>é¸ä¿®3ç§‘ç›®</label>
                            <select id="elective3Subject">
                                <option value="">è«‹é¸æ“‡ç§‘ç›®</option>
                                <option value="Biology">Biology</option>
                                <option value="Chemistry">Chemistry</option>
                                <option value="Physics">Physics</option>
                                <option value="Economics">Economics</option>
                                <option value="Chinese History">Chinese History</option>
                                <option value="Geography">Geography</option>
                                <option value="ICT">ICT</option>
                                <option value="M1">M1</option>
                                <option value="M2">M2</option>
                            </select>
                        </div>
                        <div>
                            <label>åˆ†æ•¸ (0-100)</label>
                            <input type="number" id="elective3Score" min="0" max="100" placeholder="0-100">
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn-primary" onclick="calculateResults()">è¨ˆç®—æˆç¸¾</button>
        </div>

        <!-- çµæœé¡¯ç¤º -->
        <div id="results" class="card results">
            <h2>âœ… è¨ˆç®—çµæœ</h2>

            <!-- æ ¸å¿ƒç§‘ç›®çµæœ -->
            <div class="result-section">
                <h3>æ ¸å¿ƒç§‘ç›®æˆç¸¾</h3>
                <div id="coreResults"></div>
            </div>

            <!-- é¸ä¿®ç§‘ç›®çµæœ -->
            <div id="electiveResults" class="result-section hidden">
                <h3>é¸ä¿®ç§‘ç›®æˆç¸¾</h3>
                <div id="electiveResultsContent"></div>
            </div>

            <!-- Best 5 çµæœ -->
            <div class="best5-section">
                <h3>Best 5 è¨ˆç®—çµæœ</h3>
                <div id="best5Results"></div>
                <div id="best5Combination"></div>
            </div>

            <div class="note">
                <p><strong>æ³¨ï¼š</strong>å¤§å­¸å…¥å­¸è¨ˆåˆ†æ¨™æº–ï¼ˆ5**=7åˆ†ï¼Œ5*=6åˆ†ï¼Œ5=5åˆ†ï¼Œ4=4åˆ†ï¼Œ3=3åˆ†ï¼Œ2=2åˆ†ï¼Œ1=1åˆ†ï¼‰</p>
                <p><strong>å­¸æ ¡åŠ æ¬Šå¹³å‡åˆ†è¨ˆç®—ï¼š</strong>ï¼ˆä¸­æ–‡+è‹±æ–‡+æ•¸å­¸ï¼‰Ã—3 + é¸ä¿®ç§‘Ã—2 ç„¶å¾Œé™¤ä»¥15</p>
            </div>
        </div>
    </div>

    <script>
        // ç­‰ç´š2çš„æœ€ä½åˆ†æ•¸ç·š
        const grade2Cutoff = {
            english: 35,
            chinese: 40,
            math: 38
        };

        // è¨ˆç®—ç¸½åˆ†
        function calculateTotalScore(subject, p1, p2, p3 = null, p4 = null) {
            if (subject === 'english') {
                return p1 * 0.25 + p2 * 0.25 + p3 * 0.35 + p4 * 0.15;
            } else if (subject === 'chinese') {
                return p1 * 0.5 + p2 * 0.5;
            } else if (subject === 'math') {
                return p1 * 0.65 + p2 * 0.35;
            }
            return 0;
        }

        // åˆ†æ•¸è½‰ç­‰ç´š
        function scoreToGrade(score) {
            if (score >= 90) return { grade: '5**', points: 7 };
            if (score >= 80) return { grade: '5*', points: 6 };
            if (score >= 70) return { grade: '5', points: 5 };
            if (score >= 60) return { grade: '4', points: 4 };
            if (score >= 50) return { grade: '3', points: 3 };
            if (score >= 40) return { grade: '2', points: 2 };
            return { grade: '1', points: 1 };
        }

        // è¨ˆç®—å­¸æ ¡åŠ æ¬Šå¹³å‡åˆ†
        function calculateSchoolWeightedAverage(chineseTotal, englishTotal, mathTotal, electives) {
            const coreWeighted = (chineseTotal + englishTotal + mathTotal) * 3;
            const electiveWeighted = electives.reduce((sum, elective) => sum + elective.score * 2, 0);
            return (coreWeighted + electiveWeighted) / 15;
        }

        function calculateResults() {
            const warnings = [];
            
            // å–å¾—åˆ†æ•¸
            const englishTotal = calculateTotalScore('english', 
                parseFloat(document.getElementById('englishP1').value) || 0,
                parseFloat(document.getElementById('englishP2').value) || 0,
                parseFloat(document.getElementById('englishP3').value) || 0,
                parseFloat(document.getElementById('englishP4').value) || 0
            );
            
            const chineseTotal = calculateTotalScore('chinese',
                parseFloat(document.getElementById('chineseP1').value) || 0,
                parseFloat(document.getElementById('chineseP2').value) || 0
            );
            
            const mathTotal = calculateTotalScore('math',
                parseFloat(document.getElementById('mathP1').value) || 0,
                parseFloat(document.getElementById('mathP2').value) || 0
            );

            // æª¢æŸ¥æ˜¯å¦ä½æ–¼ç­‰ç´š2åˆ†æ•¸ç·š
            if (englishTotal < grade2Cutoff.english) {
                warnings.push('è‹±æ–‡ç¸½åˆ†ä½æ–¼ç­‰ç´š2åˆ†æ•¸ç·šï¼Œå»ºè­°æ”¾æ£„æ­¤ç§‘ç›®');
            }
            if (chineseTotal < grade2Cutoff.chinese) {
                warnings.push('ä¸­æ–‡ç¸½åˆ†ä½æ–¼ç­‰ç´š2åˆ†æ•¸ç·šï¼Œå»ºè­°æ”¾æ£„æ­¤ç§‘ç›®');
            }
            if (mathTotal < grade2Cutoff.math) {
                warnings.push('æ•¸å­¸ç¸½åˆ†ä½æ–¼ç­‰ç´š2åˆ†æ•¸ç·šï¼Œå»ºè­°æ”¾æ£„æ­¤ç§‘ç›®');
            }

            // é¡¯ç¤º/éš±è—è­¦å‘Š
            const warningsDiv = document.getElementById('warnings');
            const warningMessages = document.getElementById('warning-messages');
            
            if (warnings.length > 0) {
                warningMessages.innerHTML = warnings.map(w => `<p>${w}</p>`).join('');
                warningsDiv.classList.remove('hidden');
                document.getElementById('results').classList.remove('show');
                return;
            } else {
                warningsDiv.classList.add('hidden');
            }

            // è¨ˆç®—ç­‰ç´š
            const englishGrade = scoreToGrade(englishTotal);
            const chineseGrade = scoreToGrade(chineseTotal);
            const mathGrade = scoreToGrade(mathTotal);

            // è™•ç†é¸ä¿®ç§‘ç›®
            const electives = [];
            for (let i = 1; i <= 3; i++) {
                const subject = document.getElementById(`elective${i}Subject`).value;
                const score = parseFloat(document.getElementById(`elective${i}Score`).value);
                
                if (subject && !isNaN(score)) {
                    electives.push({
                        subject: subject,
                        score: score,
                        ...scoreToGrade(score)
                    });
                }
            }

            // Best 5 è¨ˆç®—
            const allSubjects = [
                { name: 'ä¸­æ–‡', score: chineseTotal, ...chineseGrade },
                { name: 'è‹±æ–‡', score: englishTotal, ...englishGrade },
                { name: 'æ•¸å­¸', score: mathTotal, ...mathGrade },
                ...electives
            ];

            allSubjects.sort((a, b) => b.points - a.points);
            const best5 = allSubjects.slice(0, 5);
            const best5Total = best5.reduce((sum, subject) => sum + subject.score, 0);
            const best5Points = best5.reduce((sum, subject) => sum + subject.points, 0);
            
            const schoolWeightedAverage = calculateSchoolWeightedAverage(chineseTotal, englishTotal, mathTotal, electives);
            const citizenship = document.getElementById('citizenship').value;

            // é¡¯ç¤ºçµæœ
            displayResults({
                coreSubjects: {
                    chinese: { total: chineseTotal, ...chineseGrade },
                    english: { total: englishTotal, ...englishGrade },
                    math: { total: mathTotal, ...mathGrade }
                },
                electives,
                best5,
                best5Total: best5Total.toFixed(1),
                best5Points,
                schoolWeightedAverage: schoolWeightedAverage.toFixed(1),
                citizenship
            });
        }

        function displayResults(results) {
            // æ ¸å¿ƒç§‘ç›®çµæœ
            const coreResults = document.getElementById('coreResults');
            coreResults.innerHTML = `
                <div class="result-item">
                    <span>ä¸­æ–‡ï¼š${results.coreSubjects.chinese.total.toFixed(1)}åˆ†</span>
                    <span class="result-grade">${results.coreSubjects.chinese.grade}</span>
                </div>
                <div class="result-item">
                    <span>è‹±æ–‡ï¼š${results.coreSubjects.english.total.toFixed(1)}åˆ†</span>
                    <span class="result-grade">${results.coreSubjects.english.grade}</span>
                </div>
                <div class="result-item">
                    <span>æ•¸å­¸ï¼š${results.coreSubjects.math.total.toFixed(1)}åˆ†</span>
                    <span class="result-grade">${results.coreSubjects.math.grade}</span>
                </div>
                <div class="result-item">
                    <span>å…¬æ°‘èˆ‡ç¤¾æœƒç™¼å±•ç§‘</span>
                    <span style="color: #16a34a; font-weight: 600;">${results.citizenship}</span>
                </div>
            `;

            // é¸ä¿®ç§‘ç›®çµæœ
            const electiveResults = document.getElementById('electiveResults');
            const electiveResultsContent = document.getElementById('electiveResultsContent');
            
            if (results.electives.length > 0) {
                electiveResults.classList.remove('hidden');
                electiveResultsContent.innerHTML = results.electives.map(elective => `
                    <div class="result-item">
                        <span>${elective.subject}ï¼š${elective.score}åˆ†</span>
                        <span class="result-grade">${elective.grade}</span>
                    </div>
                `).join('');
            } else {
                electiveResults.classList.add('hidden');
            }

            // Best 5 çµæœ
            const best5Results = document.getElementById('best5Results');
            best5Results.innerHTML = `
                <div class="result-item">
                    <span>Best 5 åŸå§‹ç¸½åˆ†ï¼š</span>
                    <span class="result-grade">${results.best5Total}åˆ†</span>
                </div>
                <div class="result-item">
                    <span>Best 5 ç­‰ç´šç¸½åˆ†ï¼ˆå¤§å­¸è¨ˆåˆ†ï¼‰ï¼š</span>
                    <span class="result-grade">${results.best5Points}åˆ†</span>
                </div>
                <div class="result-item">
                    <span>å­¸æ ¡åŠ æ¬Šå¹³å‡åˆ†ï¼š</span>
                    <span class="result-grade">${results.schoolWeightedAverage}åˆ†</span>
                </div>
            `;

            const best5Combination = document.getElementById('best5Combination');
            best5Combination.innerHTML = `
                <div style="margin-top: 16px; padding: 12px; background: white; border-radius: 6px; border: 1px solid #e5e7eb;">
                    <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 8px;">Best 5 ç­‰ç´šçµ„åˆï¼š</p>
                    <p style="font-weight: 600; color: #1f2937;">
                        ${results.best5.map(subject => subject.grade).join(' / ')}
                    </p>
                </div>
            `;

            document.getElementById('results').classList.add('show');
        }
    </script>
</body>
</html>
